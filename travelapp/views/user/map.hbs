<style>
  #sample-map {

    width: 55vw;
    height: 75vh;
  }
</style>
<h1>Page showing map</h1>
<div id='sample-map'></div>

<script>
  const $sampleMap = document.getElementById('sample-map');

  
  const list = [
    {{#each posts}}
      {
        id: "{{_id}}",
        position: {
          lat: {{ location.coordinates.[0] }},
          lng: {{ location.coordinates.[1] }}
        },
        title: "{{title}}"
      },
    {{/each}}
  ];


  const markers = [];

  function initMap(){
    const map = new window.google.maps.Map($sampleMap, {
          center: { lat: 38, lng: -9 },
          zoom: 2,
          styles: [
            {elementType: 'geometry', stylers: [{color: '#242f3e'}]},
            {elementType: 'labels.text.stroke', stylers: [{color: '#242f3e'}]},
            {elementType: 'labels.text.fill', stylers: [{color: '#746855'}]},
            {
              featureType: 'administrative.locality',
              elementType: 'labels.text.fill',
              stylers: [{color: '#d59563'}]
            },
            {
              featureType: 'poi',
              elementType: 'labels.text.fill',
              stylers: [{color: '#d59563'}]
            },
            {
              featureType: 'poi.park',
              elementType: 'geometry',
              stylers: [{color: '#263c3f'}]
            },
            {
              featureType: 'poi.park',
              elementType: 'labels.text.fill',
              stylers: [{color: '#6b9a76'}]
            },
            {
              featureType: 'road',
              elementType: 'geometry',
              stylers: [{color: '#38414e'}]
            },
            {
              featureType: 'road',
              elementType: 'geometry.stroke',
              stylers: [{color: '#212a37'}]
            },
            {
              featureType: 'road',
              elementType: 'labels.text.fill',
              stylers: [{color: '#9ca5b3'}]
            },
            {
              featureType: 'road.highway',
              elementType: 'geometry',
              stylers: [{color: '#746855'}]
            },
            {
              featureType: 'road.highway',
              elementType: 'geometry.stroke',
              stylers: [{color: '#1f2835'}]
            },
            {
              featureType: 'road.highway',
              elementType: 'labels.text.fill',
              stylers: [{color: '#f3d19c'}]
            },
            {
              featureType: 'transit',
              elementType: 'geometry',
              stylers: [{color: '#2f3948'}]
            },
            {
              featureType: 'transit.station',
              elementType: 'labels.text.fill',
              stylers: [{color: '#d59563'}]
            },
            {
              featureType: 'water',
              elementType: 'geometry',
              stylers: [{color: '#17263c'}]
            },
            {
              featureType: 'water',
              elementType: 'labels.text.fill',
              stylers: [{color: '#515c6d'}]
            },
            {
              featureType: 'water',
              elementType: 'labels.text.stroke',
              stylers: [{color: '#17263c'}]
            }
          ]
    });

    //const image = {
    //  url: 'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png',
    //  size: new google.maps.Size(20, 32),
    //  origin: new google.maps.Point(0, 0),
    //  anchor: new google.maps.Point(0, 32)
    //};

    for (place of list) {
      console.log(place);
      const marker = new window.google.maps.Marker({
        position: place.position,
        map,
        animation: google.maps.Animation.DROP,
        icon: {
          url: "http://maps.google.com/mapfiles/ms/icons/orange-dot.png"
        }
      });
      markers.push(marker);
    }
    
    let infoWindow = null;

    markers.map((marker, index) => {
      marker.addListener(('click'), () => {
          if (marker.getAnimation() !== null) {
            infoWindow.close();
            marker.setAnimation(null);
          } else {
            infoWindow = new window.google.maps.InfoWindow({
              content: '<a href="/logged/post/' + list[index].id + '">' + list[index].title + '</a>'
            });
            infoWindow.open(map, marker);
            marker.setAnimation(google.maps.Animation.BOUNCE);
          }

      });
      }
    )
  }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBrJ1f_9MB0iFA2zFsHIbIK8sGWU91aQr8&callback=initMap"></script>
